You are an expert software engineer and trading systems architect executing a Ralph Loop to prepare SOLAT v3.1 for LIVE trading deployment.

# CONTEXT

## Project: SOLAT v3.1
- Tauri desktop trading terminal + Python FastAPI backend
- IG broker integration (LIVE account WVK88 configured)
- 37 instruments, 1.5GB historical data (2020-2025)
- 8 Ichimoku-based trading bots ("Elite 8")

## Current State
✅ Historical data imported (37 instruments)
✅ IG LIVE login working
✅ Walk-forward bug fixed (combined_metrics)
✅ DI refactor complete in routes
❌ Test suite broken (43 errors, 14 failures)
⚠️ IG LIVE epic mapping partial (3/10 FX)
❌ Paper trading not started
❌ Risk controls not audited

## Key Files
```
engine/
├── solat_engine/
│   ├── api/                 # Routes (DI refactored)
│   ├── backtest/           # Backtesting engine
│   ├── catalog/seed.py     # Needs live_epic values
│   ├── config.py           # get_settings_dep for DI
│   └── main.py             # Entry point (fixed)
├── tests/                   # Needs DI migration
├── scripts/
│   ├── import_histdata.py
│   └── check_data_quality.py
└── data/parquet/bars/      # 1.5GB historical data
```

# RALPH LOOP PROTOCOL

For EACH phase, execute this cycle until exit criteria met (max 5 iterations):

1. **ASSESS**: What criteria remain unmet?
2. **PLAN**: List 1-5 specific tasks ordered by dependency
3. **EXECUTE**: Make ONE logical change, validate immediately
4. **VALIDATE**: Run specified commands, parse for pass/fail
5. **EVALUATE**: PROCEED (next phase) | RETRY (same phase) | BLOCKED (need input)

# PHASES (Execute in order, do not skip)

## PHASE 1: Test Suite [CRITICAL]
**Goal**: All tests pass with new DI pattern

**Tasks**:
1. Create tests/conftest.py with app.dependency_overrides fixtures
2. Migrate test files to use fixtures instead of @patch
3. Run pytest after each migration

**Pattern to implement**:
```python
# tests/conftest.py
import pytest
from fastapi.testclient import TestClient
from solat_engine.main import app
from solat_engine.config import Settings, get_settings_dep

@pytest.fixture
def test_settings(tmp_path):
    return Settings(data_dir=tmp_path, mode="paper", env="test")

@pytest.fixture
def client(test_settings):
    def override():
        return test_settings
    app.dependency_overrides[get_settings_dep] = override
    yield TestClient(app)
    app.dependency_overrides.clear()
```

**Exit**: `pytest --tb=short` returns 0 errors, 0 failures

## PHASE 2: IG LIVE Epic Mapping [HIGH]
**Goal**: All instruments have correct LIVE epics

**Tasks**:
1. Add live_epic to remaining CatalogueSeedItem entries
2. Update catalog service to use live_epic when IG_ACC_TYPE=LIVE
3. Test with LIVE API

**IG Epic Patterns**:
- DEMO: CS.D.{PAIR}.MINI.IP
- LIVE: CS.D.{PAIR}.TODAY.IP (or CFD.D.{PAIR}.CFD.IP for CFDs)

**Exit**: All 10 FX pairs configured with live_epic

## PHASE 3: Data Quality [MEDIUM]
**Goal**: Validate imported historical data

**Command**: `python scripts/check_data_quality.py --timeframe 1h`

**Exit**: 37/37 instruments pass (allowing weekend gaps)

## PHASE 4: Backtest Suite [HIGH]
**Goal**: Verify backtesting works

**Tasks**:
1. Start engine: `uvicorn solat_engine.main:app --port 8765`
2. Run single bot: POST /backtest/run with TKCrossSniper on EURUSD
3. Run Grand Sweep: All bots × top 5 pairs

**Exit**: At least 2 bots with Sharpe > 1.0

## PHASE 5: Walk-Forward [MEDIUM]
**Goal**: Validate OOS performance

**Config**: 6mo in-sample, 2mo out-of-sample, 4 windows

**Exit**: OOS Sharpe > 60% of IS Sharpe

## PHASE 6: Paper Trading [HIGH]
**Goal**: 24h stable operation

**Exit**: No crashes, signals match expectations

## PHASE 7: Risk Controls [CRITICAL]
**Goal**: Kill switch and limits work

**Tests**:
1. Activate kill switch
2. Verify orders blocked
3. Reset kill switch

**Exit**: All risk controls functional

## PHASE 8: Go-Live [CRITICAL]
**Goal**: First LIVE trade

**Exit**: Trade executed safely with minimum size

# OUTPUT FORMAT

For each phase iteration:
```
══════════════════════════════════════════
PHASE {N}: {NAME} | Iteration {I}
══════════════════════════════════════════

ASSESS:
- Met: {criteria}
- Remaining: {criteria}

PLAN:
1. {task}
2. {task}

EXECUTE:
{changes made}

VALIDATE:
{command output}
Result: PASS/FAIL

EVALUATE:
{analysis}
DECISION: PROCEED/RETRY/BLOCKED
```

# CONSTRAINTS

1. NEVER execute real trades during testing
2. ONE logical change per iteration
3. VALIDATE after every code change
4. If BLOCKED, report immediately with specific question
5. Do NOT refactor working code

# BEGIN

Start with PHASE 1: Test Suite.

Read the following files to understand current state, then begin iteration 1:
- engine/tests/conftest.py (if exists)
- engine/tests/test_data_endpoints.py (example of fixed tests)
- engine/solat_engine/config.py (DI setup)

Assess which test files need migration and create the plan.
